# 国际化 Scripts

This directory contains TypeScript scripts for managing Dubhe documentation translations.

## 📁 Files

- `translate-docs.ts` - Automated translation script
- `validate-translations.ts` - Translation validation script
- `sync-translations.ts` - Translation synchronization script
- `package.json` - Script dependencies and configuration
- `tsconfig.json` - TypeScript configuration
- `jest.config.js` - Jest testing configuration
- `jest.setup.js` - Jest setup and mocks
- `*.test.ts` - Test files for each script

## 🚀 快速开始

### 安装

```bash
cd docs/i18n/scripts
npm install
```

### Running Scripts

```bash
# Translate documentation
npm run translate

# Validate translations
npm run validate

# Sync translations
npm run sync

# Run tests
npm test

# Lint code
npm run lint

# Format code
npm run format
```

## 📋 Script Details

### translate-docs.ts

Automatically translates documentation files from English to other supported languages.

**Features:**

- Scans for files that need translation
- Preserves code blocks and links
- Applies translation mappings
- Generates translation reports
- Prioritizes important pages

**Usage:**

```bash
npm run translate
# or
tsx translate-docs.ts
```

**配置:**

- Reads from `../config.json`
- 支持s English → Chinese and English → Japanese
- Preserves technical terms (CLI, API, SDK, etc.)

### validate-translations.ts

Validates translated files for quality and consistency.

**Checks:**

- Missing or broken links
- Inconsistent terminology
- Format errors (unclosed code blocks, etc.)
- Missing content
- Translation quality scoring

**Usage:**

```bash
npm run validate
# or
tsx validate-translations.ts
```

**Output:**

- Console report with scores and issues
- JSON report saved to `../validation-report.json`

### sync-translations.ts

Synchronizes translations across all locales, preserving existing work.

**Features:**

- Preserves existing translations
- Backs up files before modification
- Only updates when source is newer
- Merges content intelligently
- Runs validation after sync

**Usage:**

```bash
npm run sync
# or
tsx sync-translations.ts
```

**Options:**

- `preserveExisting`: Keep existing translations
- `backupBeforeSync`: Create backups before changes
- `validateAfterSync`: Run validation after sync

## 🧪 测试

### Running Tests

```bash
npm test
```

### Test Coverage

```bash
npm test -- --coverage
```

### Test Files

- `translate-docs.test.ts` - Tests for translation script
- `validate-translations.test.ts` - Tests for validation script
- `sync-translations.test.ts` - Tests for sync script

### Test Setup

The `jest.setup.js` file provides:

- File system mocks
- Console output mocks
- Test environment configuration

## 🔧 配置

### TypeScript 配置

The `tsconfig.json` extends the root configuration and provides:

- ES2020 target
- ESNext modules
- Strict type checking
- Source maps and declarations

### Jest 配置

The `jest.config.js` provides:

- TypeScript support via ts-jest
- Coverage reporting
- File system mocking
- Test environment setup

### Package 配置

The `package.json` includes:

- Script commands
- 开发 dependencies
- TypeScript and testing tools

## 📊 Reports

### Translation Report

Generated by `translate-docs.ts`:

```json
{
  "timestamp": "2024-12-01T00:00:00.000Z",
  "stats": {
    "zh": { "total": 10, "translated": 8, "pending": 2 },
    "ja": { "total": 10, "translated": 5, "pending": 5 }
  },
  "tasks": [...]
}
```

### Validation Report

Generated by `validate-translations.ts`:

```json
{
  "timestamp": "2024-12-01T00:00:00.000Z",
  "summary": {
    "totalFiles": 15,
    "totalIssues": 3,
    "averageScore": 95.2
  },
  "results": [...]
}
```

### Sync Report

Generated by `sync-translations.ts`:

```json
{
  "timestamp": "2024-12-01T00:00:00.000Z",
  "stats": {
    "filesProcessed": 10,
    "filesCreated": 3,
    "filesUpdated": 5,
    "filesSkipped": 2,
    "errors": 0
  },
  "successRate": 100.0
}
```

## 🔄 Workflow

### Typical Translation Workflow

1. **Create English content** in `docs/` directory
2. **Run translation**:
   ```bash
   npm run translate
   ```
3. **Review translations** manually
4. **Validate quality**:
   ```bash
   npm run validate
   ```
5. **Fix issues** found by validation
6. **Commit changes** to version control

### Ongoing Maintenance

1. **Update English content** as needed
2. **Sync translations**:
   ```bash
   npm run sync
   ```
3. **Review changes** and ensure quality
4. **Update status** in `../config.json`

## 🛠️ 开发

### Adding New Languages

1. **Update translation maps** in scripts
2. **Add language configuration** to `../config.json`
3. **Create language directory** structure
4. **Update tests** to include new language

### Extending Translation Logic

1. **Modify translation mappings** in scripts
2. **Add new validation rules** in `validate-translations.ts`
3. **Update sync logic** in `sync-translations.ts`
4. **Add corresponding tests**

### Customizing Quality Checks

1. **Modify validation rules** in `validate-translations.ts`
2. **Adjust scoring algorithm** in `calculateScore()`
3. **Add new issue types** to `ValidationIssue` interface
4. **Update tests** for new validation logic

## 📝 Best Practices

### Code Quality

- **Type safety**: All scripts use TypeScript with strict mode
- **Error handling**: Graceful error handling with user-friendly messages
- **测试**: Comprehensive test coverage for all functionality
- **文档**: Clear comments and README files

### Translation Quality

- **Consistency**: Use consistent terminology across all languages
- **Preservation**: Preserve technical terms and code examples
- **Validation**: Run validation after every translation
- **Review**: Manual review of automated translations

### 性能

- **Incremental updates**: Only process changed files
- **Parallel processing**: Process multiple files simultaneously
- **Caching**: Cache translation results where appropriate
- **Optimization**: Minimize file system operations

## 🐛 故障排除

### Common Issues

1. **File not found errors**: Check file paths and permissions
2. **Translation quality issues**: Review translation mappings
3. **Validation failures**: Fix format and content issues
4. **Sync conflicts**: Resolve merge conflicts manually

### Debug Mode

Enable debug logging by setting environment variable:

```bash
DEBUG=true npm run translate
```

### Log Files

Scripts generate detailed logs in:

- `../translation-report.json`
- `../validation-report.json`
- `../sync-report.json`

## 🤝 贡献

### Code Style

- Follow TypeScript best practices
- Use ESLint and Prettier
- Write comprehensive tests
- Document new features

### 测试

- Write tests for new functionality
- Maintain test coverage above 80%
- Test edge cases and error conditions
- Use meaningful test descriptions

### Pull Requests

1. **Fork the repository**
2. **Create a feature branch**
3. **Make your changes**
4. **Add tests**
5. **Run all tests**
6. **Submit a pull request**

---

**Last updated**: December 2024  
**Maintainers**: Dubhe Team  
**Version**: 1.0.0
