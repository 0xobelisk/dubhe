{"version":3,"names":["RenderReflectionProbeQueue","CC_USE_RGBE_OUTPUT","_phaseID","_phaseReflectMapID","_defineProperty","obj","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","getPassIndex","subModel","passes","r","cclegacy","rendering","isEnableEffect","getPhaseID","getPassID","k","length","enableEffectImport","phase","phaseID","getReflectMapPassIndex","_export","setters","_defineJs","SetIndex","_passPhaseJs","_pipelineStateManagerJs","PipelineStateManager","_renderSceneCorePassJs","BatchingSchemes","_renderSceneSceneReflectionProbeJs","ProbeType","_renderSceneSceneCameraJs","SKYBOX_FLAG","_renderInstancedQueueJs","RenderInstancedQueue","_coreIndexJs","geometry","execute","constructor","pipeline","_pipeline","_subModelsArray","_passArray","_shaderArray","_rgbeSubModelsArray","_instancedQueue","_patches","gatherRenderObjects","probe","camera","cmdBuff","clear","scene","sceneData","pipelineSceneData","skybox","enabled","model","clearFlag","add","models","visibility","i","node","isCulledByLod","layer","visFlags","worldBounds","bakeToReflectionProbe","probeType","CUBE","intersect","aabbWithAABB","boundingBox","aabbFrustum","frustum","uploadBuffers","subModels","j","isTransparent","blendState","targets","blend","passIdx","bUseReflectPass","pass","batchingScheme","concat","patches","useRGBEPatchs","name","onMacroPatchesStateChanged","push","INSTANCING","buffer","getInstancedBuffer","merge","queue","shader","shaders","recordCommandBuffer","device","renderPass","ia","inputAssembler","pso","getOrCreatePipelineState","descriptorSet","bindPipelineState","bindDescriptorSet","MATERIAL","LOCAL","bindInputAssembler","draw","resetRGBEMacro","patch","splice"],"sources":["file:///Users/henryliu/obelisk/fish-game/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/rendering/render-reflection-probe-queue.ts"],"mappings":"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"}