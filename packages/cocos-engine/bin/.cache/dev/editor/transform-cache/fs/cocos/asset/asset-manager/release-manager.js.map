{"version":3,"names":["ReleaseManager","_temp","releaseManager","visitAsset","asset","deps","_uuid","push","visitComponent","comp","props","Object","getOwnPropertyNames","i","length","propName","value","Array","isArray","j","val","Asset","constructor","keys","visitNode","node","_components","_children","descendOpRef","refs","exclude","op","depends","dependUtil","getDeps","l","dependAsset","assets","get","uuid","refCount","includes","checkCircularReference","create","setters","_virtualInternal253AconstantsJs","EDITOR","TEST","_assetsAssetJs","_coreIndexJs","isValid","js","misc","_cacheJs","Cache","default","_dependUtilJs","_sharedJs","references","execute","_persistNodeDeps","_toDelete","_eventListener","_dontDestroyAssets","addIgnoredAsset","init","clear","_addPersistNodeRef","addRef","add","_removePersistNodeRef","has","decRef","remove","_autoRelease","oldScene","newScene","persistNodes","childs","autoReleaseAssets","dependencies","_depends","persistDeps","sceneDeps","key","dep","tryRelease","force","_free","callInNextTick","_freeAssets","bind","forEach","indexOf","destroy","dependant","dependance","deref","array","fastRemoveAt","_export"],"sources":["file:///Users/henryliu/obelisk/fish-game/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/asset/asset-manager/release-manager.ts"],"mappings":"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"}