{"version":3,"names":["ccclass","_coreDataDecoratorsIndexJs","_gfxIndexJs","Color","Rect","_renderStageJs","RenderStage","_enumJs","ForwardStagePriority","_renderShadowMapBatchedQueueJs","RenderShadowMapBatchedQueue","_defineJs","SetIndex","_renderSceneSceneLightJs","LightType","_renderSceneSceneShadowsJs","CSMLevel","execute","colors","_export","ShadowStage","_dec","_class","_class2","constructor","args","_additiveShadowQueue","_shadowFrameBuffer","_renderArea","_light","_globalDS","_level","_isShadowMapCleared","setUsage","globalDS","light","shadowFrameBuffer","level","destroy","_this$_additiveShadow","clear","clearFramebuffer","camera","w","clearColor","pipeline","_pipeline","pipelineSceneData","shadingScale","shadowInfo","shadows","vp","viewport","shadowMapSize","size","x","y","width","height","cmdBuff","commandBuffers","renderPass","beginRenderPass","clearDepth","clearStencil","endRenderPass","render","descriptorSet","device","pipelineUBO","updateShadowUBOLight","gatherLightPasses","type","DIRECTIONAL","mainLight","shadowFixedArea","csmLevel","LEVEL_1","csmSupported","screenSpaceSignY","capabilities","Math","floor","SPOT","bindDescriptorSet","GLOBAL","recordCommandBuffer","activate","flow","initInfo","name","priority","FORWARD","tag"],"sources":["file:///Users/henryliu/obelisk/fish-game/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/rendering/shadow/shadow-stage.ts"],"mappings":"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"}