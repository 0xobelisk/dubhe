{"version":3,"names":["getShadowPassIndex","subModel","passes","r","cclegacy","rendering","isEnableEffect","_phaseID","getPhaseID","getPassID","k","length","enableEffectImport","phase","phaseID","setters","_defineJs","SetIndex","_passPhaseJs","_pipelineStateManagerJs","PipelineStateManager","_renderSceneCorePassJs","BatchingSchemes","_renderInstancedQueueJs","RenderInstancedQueue","_renderSceneSceneShadowsJs","ShadowType","_renderSceneSceneLightJs","LightType","_coreIndexJs","geometry","_sceneCullingJs","shadowCulling","execute","_export","RenderShadowMapBatchedQueue","pipeline","_pipeline","_subModelsArray","_passArray","_shaderArray","_instancedQueue","_proto","prototype","gatherLightPasses","camera","light","cmdBuff","level","clear","sceneData","pipelineSceneData","shadowInfo","shadows","enabled","type","ShadowMap","DIRECTIONAL","dirLight","shadowEnabled","csmLayers","layer","shadowFixedArea","specialLayer","layers","dirShadowObjects","shadowObjects","i","ro","model","add","SPOT","spotLight","visibility","castShadowObjects","worldBounds","node","intersect","aabbFrustum","frustum","uploadBuffers","subModels","j","shadowPassIdx","pass","batchingScheme","INSTANCING","buffer","getInstancedBuffer","merge","queue","shader","shaders","push","recordCommandBuffer","device","renderPass","ia","inputAssembler","pso","getOrCreatePipelineState","descriptorSet","bindPipelineState","bindDescriptorSet","MATERIAL","LOCAL","bindInputAssembler","draw"],"sources":["../../../../../../../../cocos/rendering/render-shadow-map-batched-queue.ts"],"mappings":"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"}