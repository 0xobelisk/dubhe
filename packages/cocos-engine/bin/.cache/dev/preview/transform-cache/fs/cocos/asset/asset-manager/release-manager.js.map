{"version":3,"names":["visitAsset","asset","deps","_uuid","push","visitComponent","comp","props","Object","getOwnPropertyNames","i","length","propName","value","Array","isArray","j","val","Asset","constructor","keys","visitNode","node","_components","_children","descendOpRef","refs","exclude","op","depends","dependUtil","getDeps","l","dependAsset","assets","get","uuid","refCount","includes","checkCircularReference","create","_temp","setters","_virtualInternal253AconstantsJs","EDITOR","TEST","_assetsAssetJs","_coreIndexJs","isValid","js","misc","_cacheJs","Cache","default","_dependUtilJs","_sharedJs","references","execute","ReleaseManager","_persistNodeDeps","_toDelete","_eventListener","_dontDestroyAssets","_proto","prototype","addIgnoredAsset","init","clear","_addPersistNodeRef","addRef","add","_removePersistNodeRef","has","decRef","remove","_autoRelease","oldScene","newScene","persistNodes","childs","autoReleaseAssets","dependencies","_depends","persistDeps","sceneDeps","key","_ref","_iterator","_createForOfIteratorHelperLoose","_step","done","dep","apply","tryRelease","force","_free","callInNextTick","_freeAssets","bind","_this","forEach","indexOf","destroy","dependant","dependance","deref","array","fastRemoveAt","_export","releaseManager"],"sources":["../../../../../../../../../cocos/asset/asset-manager/release-manager.ts"],"mappings":"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"}