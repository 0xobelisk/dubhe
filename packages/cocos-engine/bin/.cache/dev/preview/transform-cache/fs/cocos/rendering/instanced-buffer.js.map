{"version":3,"names":["UNIFORM_LIGHTMAP_TEXTURE_BINDING","_defineJs","UNIFORM_REFLECTION_PROBE_BLEND_CUBEMAP_BINDING","UNIFORM_REFLECTION_PROBE_CUBEMAP_BINDING","UNIFORM_REFLECTION_PROBE_TEXTURE_BINDING","_gfxIndexJs","BufferUsageBit","MemoryUsageBit","InputAssemblerInfo","Attribute","BufferInfo","execute","INITIAL_CAPACITY","MAX_CAPACITY","_export","InstancedBuffer","pass","instances","hasPendingModels","dynamicOffsets","_device","device","_proto","prototype","destroy","i","length","instance","vb","ia","merge","subModel","passIdx","shaderImplant","attrs","instancedAttributeBlock","stride","buffer","sourceIA","inputAssembler","lightingMap","descriptorSet","getTexture","reflectionProbeCubemap","reflectionProbePlanarMap","reflectionProbeBlendCubemap","useReflectionProbeType","shader","shaders","_instance$ia$indexBuf","_sourceIA$indexBuffer","indexBuffer","objectID","count","capacity","newSize","oldData","data","Uint8Array","set","resize","createBuffer","VERTEX","TRANSFER_DST","HOST","DEVICE","vertexBuffers","slice","attributes","attr","newAttr","name","format","isNormalized","push","iaInfo","createInputAssembler","uploadBuffers","cmdBuff","instanceCount","updateBuffer","clear"],"sources":["../../../../../../../../cocos/rendering/instanced-buffer.ts"],"mappings":";;;;;;MA0BSA,gCAAgC,GAAAC,SAAA,CAAhCD,gCAAgC;MAAEE,8CAA8C,GAAAD,SAAA,CAA9CC,8CAA8C;MAAEC,wCAAwC,GAAAF,SAAA,CAAxCE,wCAAwC;MAC/HC,wCAAwC,GAAAH,SAAA,CAAxCG,wCAAwC;IAAA,aAAAC,WAAA;MACnCC,cAAc,GAAAD,WAAA,CAAdC,cAAc;MAAEC,cAAc,GAAAF,WAAA,CAAdE,cAAc;MAAmCC,kBAAkB,GAAAH,WAAA,CAAlBG,kBAAkB;MACxFC,SAAS,GAAAJ,WAAA,CAATI,SAAS;MAAUC,UAAU,GAAAL,WAAA,CAAVK,UAAU;IAAA;IAAAC,OAAA,WAAAA,CAAA;MA7BjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MAyBMC,gBAAgB,GAAG,EAAE;MACrBC,YAAY,GAAG,IAAI;MAAAC,OAAA,oBAEZC,eAAe;QAOxB,SAAAA,gBAAaC,IAAU,EAAE;UAAA,KANlBC,SAAS,GAAqB,EAAE;UAAA,KAChCD,IAAI;UAAA,KACJE,gBAAgB,GAAG,KAAK;UAAA,KACxBC,cAAc,GAAa,EAAE;UAAA,KAC5BC,OAAO;UAGX,IAAI,CAACA,OAAO,GAAGJ,IAAI,CAACK,MAAM;UAC1B,IAAI,CAACL,IAAI,GAAGA,IAAI;QACpB;QAAC,IAAAM,MAAA,GAAAP,eAAA,CAAAQ,SAAA;QAAAD,MAAA,CAEME,OAAO,GAAd,SAAAA,QAAA,EAAwB;UACpB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACR,SAAS,CAACS,MAAM,EAAE,EAAED,CAAC,EAAE;YAC5C,IAAME,QAAQ,GAAG,IAAI,CAACV,SAAS,CAACQ,CAAC,CAAC;YAClCE,QAAQ,CAACC,EAAE,CAACJ,OAAO,CAAC,CAAC;YACrBG,QAAQ,CAACE,EAAE,CAACL,OAAO,CAAC,CAAC;UACzB;UACA,IAAI,CAACP,SAAS,CAACS,MAAM,GAAG,CAAC;QAC7B,CAAC;QAAAJ,MAAA,CAEMQ,KAAK,GAAZ,SAAAA,MAAcC,QAAkB,EAAEC,OAAe,EAAEC,aAA4B,EAAe;UAAA,IAA3CA,aAA4B;YAA5BA,aAA4B,GAAG,IAAI;UAAA;UAClF,IAAMC,KAAK,GAAGH,QAAQ,CAACI,uBAAuB;UAC9C,IAAMC,MAAM,GAAGF,KAAK,CAACG,MAAM,CAACX,MAAM;UAClC,IAAI,CAACU,MAAM,EAAE;YAAE;UAAQ,CAAC,CAAC;UACzB,IAAME,QAAQ,GAAGP,QAAQ,CAACQ,cAAc;UACxC,IAAMC,WAAW,GAAGT,QAAQ,CAACU,aAAa,CAACC,UAAU,CAAC1C,gCAAgC,CAAC;UACvF,IAAM2C,sBAAsB,GAAGZ,QAAQ,CAACU,aAAa,CAACC,UAAU,CAACvC,wCAAwC,CAAC;UAC1G,IAAMyC,wBAAwB,GAAGb,QAAQ,CAACU,aAAa,CAACC,UAAU,CAACtC,wCAAwC,CAAC;UAC5G,IAAMyC,2BAA2B,GAAGd,QAAQ,CAACU,aAAa,CAACC,UAAU,CAACxC,8CAA8C,CAAC;UACrH,IAAM4C,sBAAsB,GAAGf,QAAQ,CAACe,sBAAsB;UAC9D,IAAIC,MAAM,GAAGd,aAAa;UAC1B,IAAI,CAACc,MAAM,EAAE;YACTA,MAAM,GAAGhB,QAAQ,CAACiB,OAAO,CAAChB,OAAO,CAAC;UACtC;UACA,IAAMS,aAAa,GAAGV,QAAQ,CAACU,aAAa;UAC5C,KAAK,IAAIhB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACR,SAAS,CAACS,MAAM,EAAE,EAAED,CAAC,EAAE;YAAA,IAAAwB,qBAAA,EAAAC,qBAAA;YAC5C,IAAMvB,QAAQ,GAAG,IAAI,CAACV,SAAS,CAACQ,CAAC,CAAC;YAClC,IAAI,EAAAwB,qBAAA,GAAAtB,QAAQ,CAACE,EAAE,CAACsB,WAAW,cAAAF,qBAAA,uBAAvBA,qBAAA,CAAyBG,QAAQ,QAAAF,qBAAA,GAAKZ,QAAQ,CAACa,WAAW,cAAAD,qBAAA,uBAApBA,qBAAA,CAAsBE,QAAQ,KAAIzB,QAAQ,CAAC0B,KAAK,IAAIxC,YAAY,EAAE;cAAE;YAAU;;YAExH;YACA,IAAIc,QAAQ,CAACa,WAAW,CAACY,QAAQ,KAAKZ,WAAW,CAACY,QAAQ,EAAE;cACxD;YACJ;YAEA,IAAIzB,QAAQ,CAACmB,sBAAsB,KAAKA,sBAAsB,EAAE;cAC5D;YACJ;YACA,IAAInB,QAAQ,CAACgB,sBAAsB,CAACS,QAAQ,KAAKT,sBAAsB,CAACS,QAAQ,EAAE;cAC9E;YACJ;YACA,IAAIzB,QAAQ,CAACiB,wBAAwB,CAACQ,QAAQ,KAAKR,wBAAwB,CAACQ,QAAQ,EAAE;cAClF;YACJ;YACA,IAAIzB,QAAQ,CAACkB,2BAA2B,CAACO,QAAQ,KAAKP,2BAA2B,CAACO,QAAQ,EAAE;cACxF;YACJ;YAEA,IAAIzB,QAAQ,CAACS,MAAM,KAAKA,MAAM,EAAE;cAC5B;cACA;cACA;YACJ;YACA,IAAIT,QAAQ,CAAC0B,KAAK,IAAI1B,QAAQ,CAAC2B,QAAQ,EAAE;cAAE;cACvC3B,QAAQ,CAAC2B,QAAQ,KAAK,CAAC;cACvB,IAAMC,OAAO,GAAG5B,QAAQ,CAACS,MAAM,GAAGT,QAAQ,CAAC2B,QAAQ;cACnD,IAAME,OAAO,GAAG7B,QAAQ,CAAC8B,IAAI;cAC7B9B,QAAQ,CAAC8B,IAAI,GAAG,IAAIC,UAAU,CAACH,OAAO,CAAC;cACvC5B,QAAQ,CAAC8B,IAAI,CAACE,GAAG,CAACH,OAAO,CAAC;cAC1B7B,QAAQ,CAACC,EAAE,CAACgC,MAAM,CAACL,OAAO,CAAC;YAC/B;YACA5B,QAAQ,CAACoB,MAAM,GAAGA,MAAM;YACxBpB,QAAQ,CAACc,aAAa,GAAGA,aAAa;YACtCd,QAAQ,CAAC8B,IAAI,CAACE,GAAG,CAACzB,KAAK,CAACG,MAAM,EAAEV,QAAQ,CAACS,MAAM,GAAGT,QAAQ,CAAC0B,KAAK,EAAE,CAAC;YACnE,IAAI,CAACnC,gBAAgB,GAAG,IAAI;YAC5B;UACJ;;UAEA;UACA,IAAMU,EAAE,GAAG,IAAI,CAACR,OAAO,CAACyC,YAAY,CAAC,IAAInD,UAAU,CAC/CJ,cAAc,CAACwD,MAAM,GAAGxD,cAAc,CAACyD,YAAY,EACnDxD,cAAc,CAACyD,IAAI,GAAGzD,cAAc,CAAC0D,MAAM,EAC3C7B,MAAM,GAAGxB,gBAAgB,EACzBwB,MACJ,CAAC,CAAC;UACF,IAAMqB,IAAI,GAAG,IAAIC,UAAU,CAACtB,MAAM,GAAGxB,gBAAgB,CAAC;UACtD,IAAMsD,aAAa,GAAG5B,QAAQ,CAAC4B,aAAa,CAACC,KAAK,CAAC,CAAC;UACpD,IAAMC,UAAU,GAAG9B,QAAQ,CAAC8B,UAAU,CAACD,KAAK,CAAC,CAAC;UAC9C,IAAMhB,WAAW,GAAGb,QAAQ,CAACa,WAAW;UAExC,KAAK,IAAI1B,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGS,KAAK,CAACkC,UAAU,CAAC1C,MAAM,EAAED,EAAC,EAAE,EAAE;YAC9C,IAAM4C,IAAI,GAAGnC,KAAK,CAACkC,UAAU,CAAC3C,EAAC,CAAC;YAChC,IAAM6C,OAAO,GAAG,IAAI7D,SAAS,CAAC4D,IAAI,CAACE,IAAI,EAAEF,IAAI,CAACG,MAAM,EAAEH,IAAI,CAACI,YAAY,EAAEP,aAAa,CAACxC,MAAM,EAAE,IAAI,CAAC;YACpG0C,UAAU,CAACM,IAAI,CAACJ,OAAO,CAAC;UAC5B;UACAb,IAAI,CAACE,GAAG,CAACzB,KAAK,CAACG,MAAM,CAAC;UAEtB6B,aAAa,CAACQ,IAAI,CAAC9C,EAAE,CAAC;UACtB,IAAM+C,MAAM,GAAG,IAAInE,kBAAkB,CAAC4D,UAAU,EAAEF,aAAa,EAAEf,WAAW,CAAC;UAC7E,IAAMtB,EAAE,GAAG,IAAI,CAACT,OAAO,CAACwD,oBAAoB,CAACD,MAAM,CAAC;UACpD;UACA,IAAI,CAAC1D,SAAS,CAACyD,IAAI,CAAC;YAAErB,KAAK,EAAE,CAAC;YAAEC,QAAQ,EAAE1C,gBAAgB;YAAEgB,EAAE,EAAFA,EAAE;YAAE6B,IAAI,EAAJA,IAAI;YAAE5B,EAAE,EAAFA,EAAE;YAAEO,MAAM,EAANA,MAAM;YAAEW,MAAM,EAANA,MAAM;YAAEN,aAAa,EAAbA,aAAa;YAAED,WAAW,EAAXA,WAAW;YAAEG,sBAAsB,EAAtBA,sBAAsB;YAAEC,wBAAwB,EAAxBA,wBAAwB;YAAEE,sBAAsB,EAAtBA,sBAAsB;YAAED,2BAA2B,EAA3BA;UAA4B,CAAC,CAAC;UAC9N,IAAI,CAAC3B,gBAAgB,GAAG,IAAI;QAChC,CAAC;QAAAI,MAAA,CAEMuD,aAAa,GAApB,SAAAA,cAAsBC,OAAsB,EAAQ;UAChD,KAAK,IAAIrD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACR,SAAS,CAACS,MAAM,EAAE,EAAED,CAAC,EAAE;YAC5C,IAAME,QAAQ,GAAG,IAAI,CAACV,SAAS,CAACQ,CAAC,CAAC;YAClC,IAAI,CAACE,QAAQ,CAAC0B,KAAK,EAAE;cAAE;YAAU;YACjC1B,QAAQ,CAACE,EAAE,CAACkD,aAAa,GAAGpD,QAAQ,CAAC0B,KAAK;YAC1CyB,OAAO,CAACE,YAAY,CAACrD,QAAQ,CAACC,EAAE,EAAED,QAAQ,CAAC8B,IAAI,CAAC;UACpD;QACJ,CAAC;QAAAnC,MAAA,CAEM2D,KAAK,GAAZ,SAAAA,MAAA,EAAsB;UAClB,KAAK,IAAIxD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACR,SAAS,CAACS,MAAM,EAAE,EAAED,CAAC,EAAE;YAC5C,IAAME,QAAQ,GAAG,IAAI,CAACV,SAAS,CAACQ,CAAC,CAAC;YAClCE,QAAQ,CAAC0B,KAAK,GAAG,CAAC;UACtB;UACA,IAAI,CAACnC,gBAAgB,GAAG,KAAK;QACjC,CAAC;QAAA,OAAAH,eAAA;MAAA;IAAA;EAAA;AAAA"}