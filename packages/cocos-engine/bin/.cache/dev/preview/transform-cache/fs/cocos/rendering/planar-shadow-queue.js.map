{"version":3,"names":["getPlanarShadowPassIndex","subModel","passes","r","cclegacy","rendering","isEnableEffect","_phaseID","getPhaseID","getPassID","k","length","enableEffectImport","phase","phaseID","setters","_coreIndexJs","geometry","_defineJs","SetIndex","_pipelineStateManagerJs","PipelineStateManager","_renderInstancedQueueJs","RenderInstancedQueue","_renderSceneSceneShadowsJs","ShadowType","_sceneGraphLayersJs","Layers","_renderSceneCorePassJs","BatchingSchemes","_passPhaseJs","execute","_ab","AABB","_export","PlanarShadowQueue","pipeline","_subModelArray","_shaderArray","_passArray","_castModels","_instancedQueue","_pipeline","_proto","prototype","clear","gatherShadowPasses","camera","cmdBuff","pipelineSceneData","shadows","enabled","type","Planar","normal","scene","frustum","shadowVisible","visibility","BitMask","DEFAULT","mainLight","models","i","model","isCulledByLod","node","castShadow","layer","push","worldBounds","transform","matLight","intersect","aabbFrustum","subModels","j","shadowPassIdx","planarShader","getPlanarShader","patches","material","pass","batchingScheme","INSTANCING","buffer","getInstancedBuffer","merge","queue","add","shader","shaders","uploadBuffers","recordCommandBuffer","device","renderPass","ia","inputAssembler","pso","getOrCreatePipelineState","descriptorSet","bindPipelineState","bindDescriptorSet","MATERIAL","LOCAL","bindInputAssembler","draw"],"sources":["../../../../../../../../cocos/rendering/planar-shadow-queue.ts"],"mappings":"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"}