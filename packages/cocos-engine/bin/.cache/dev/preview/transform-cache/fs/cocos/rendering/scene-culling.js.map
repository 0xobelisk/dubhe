{"version":3,"names":["getRenderObject","model","camera","depth","node","Vec3","subtract","_tempVec3","worldBounds","center","worldPosition","position","dot","forward","ro","roPool","alloc","validPunctualLightsCulling","pipeline","sceneData","pipelineSceneData","validPunctualLights","length","_ref","scene","spotLights","i","light","baked","globals","disableLightmap","geometry","Sphere","set","_sphere","x","y","z","range","intersect","sphereFrustum","frustum","push","_ref2","sphereLights","_ref3","pointLights","_ref4","rangedDirLights","AABB","transform","_tmpBoundingBox","_rangedDirLightBoundingBox","getWorldMatrix","aabbFrustum","shadowCulling","layer","mainLight","csmLayers","csmLayerObjects","layerObjects","dirLightFrustum","validFrustum","dirShadowObjects","shadowObjects","visibility","obj","array","fastRemove","enabled","visFlags","castShadow","accurate","level","csmLevel","csmOptimizationMode","CSMOptimizationMode","RemoveDuplicates","aabbFrustumCompletelyInside","sceneCulling","shadows","skybox","renderObjects","freeArray","castShadowObjects","clear","pipelineUBO","updateShadowUBORange","UBOShadow","SHADOW_COLOR_OFFSET","shadowColor","type","ShadowType","ShadowMap","update","clearFlag","SKYBOX_FLAG","cameraUsage","CameraUsage","EDITOR","SCENE_VIEW","cclegacy","warnID","name","models","enqueueRenderObject","isCulledByLod","_export","setters","_renderSceneSceneCameraJs","_coreIndexJs","Pool","_defineJs","_renderSceneSceneShadowsJs","_coreGeometryIndexJs","execute","create"],"sources":["../../../../../../../../cocos/rendering/scene-culling.ts"],"mappings":"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"}