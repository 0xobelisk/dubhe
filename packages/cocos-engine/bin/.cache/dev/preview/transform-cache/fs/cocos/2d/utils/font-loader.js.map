{"version":3,"names":["checkFontLoaded","allFontsLoaded","now","Date","i","_loadingFonts","length","fontLoadHandle","fontFamily","fontFamilyName","startTime","_timeout","warnID","onComplete","splice","oldWidth","refWidth","fontDesc","_canvasContext","font","newWidth","safeMeasureText","_testString","clearInterval","_intervalId","nativeCheckFontLoaded","start","callback","loader","Promise","resolve","reject","check","ccdocument","fonts","load","then","setTimeout","timeoutId","timer","race","clearTimeout","loadFont","url","options","getFontFamily","_fontFaces","labelCanvas","createElement","width","height","getContext","fontStyle","type","fontStr","Number","isNaN","textContent","body","appendChild","preloadDiv","divStyle","style","innerHTML","position","left","top","useNativeCheck","push","setInterval","fontHandle","ttfIndex","lastIndexOf","slashPos","substring","indexOf","createFont","id","data","out","TTFFont","_nativeUrl","_nativeAsset","_export","setters","_coreIndexJs","_textUtilsJs","_assetAssetManagerDownloaderJs","downloader","default","_assetAssetManagerFactoryJs","factory","_assetsTtfFontJs","_coreGlobalExportsJs","ccwindow","execute","document","Object","create","nativeCheck","undefined","match","exec","navigator","userAgent","safari10Match","vendor","parseInt","register"],"sources":["../../../../../../../../../cocos/2d/utils/font-loader.ts"],"mappings":"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"}