{"version":3,"names":["mapDefine","info","def","type","toString","undefined","options","range","console","warn","prepareDefines","defs","tDefs","macros","i","length","tmpl","name","v","value","isDefault","push","getShaderInstanceName","reduce","acc","cur","dependencyCheck","dependencies","defines","d","slice","getActiveAttributes","gfxAttributes","out","attributes","getVariantKey","programInfo","tmplDefs","uber","key","tmplDef","_map","mapped","offset","_offset","hash","getUniformSize","prevSize","m","count","GetTypeSize","defaultUniformCounts","get","error","getSize","blockMembers","genHandles","handleMap","blocks","block","members","j","uniform","genHandle","binding","samplerTextures","samplerTexture","getBitCount","cnt","Math","ceil","log2","max","populateMacros","_loop","findIndex","s","constantMacros","builtins","statistics","getCombinationDefines","combination","Object","keys","choices","_extends","addEffectDefaultProperties","effect","techniques","tech","passes","pass","propertyIndex","properties","_export","setters","_gfxBaseDefineJs","_renderingDefineJs","UBOForwardLight","UBOSkinning","_passUtilsJs","execute","Map","set","LAYOUT","LIGHTS_PER_PASS"],"sources":["../../../../../../../../../cocos/render-scene/core/program-utils.ts"],"mappings":"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"}