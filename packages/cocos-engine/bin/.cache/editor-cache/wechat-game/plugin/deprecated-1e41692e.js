System.register(["./index-92d00b49.js","./director-44a98d9f.js","./node-event-c62a1caf.js","./sprite-renderer-c04ed900.js","./pipeline-state-manager-45d8faaf.js","./buffer-barrier-a7de2d9a.js","./deprecated-c8756aed.js","./sprite-5f8bb119.js","./deprecated-8cbcc834.js"],(function(t){"use strict";var e,i,n,s,o,r,a,h,l,u,c,p,d,_,f,m,g,y,C,v,b,T,E,S,R,L,x,D,I,A,P,O,M,k,N,w,H,F,U,z,W,B,G,X,V,j,Y,J,q,Q,K,Z,$,tt,et,it,nt,st,ot,rt,at,ht,lt,ut,ct,pt,dt,_t,ft,mt,gt,yt,Ct;return{setters:[function(t){e=t.ae,i=t.bF,n=t.V,s=t.B,o=t.bE,r=t.bX,a=t.d,h=t.bC,l=t.bH,u=t.bh,c=t.bI,p=t.l,d=t.cy,_=t.c9,f=t.bj,m=t.t,g=t.o,y=t.J,C=t.e,v=t.cK,b=t.bN,T=t.i,E=t.av,S=t.w,R=t.cw,L=t.cL,x=t.cv,D=t.aj,I=t.al},function(t){A=t.aU,P=t.h,O=t.be,M=t.aY,k=t.bM,N=t.ax,w=t.bQ,H=t.a4},function(t){F=t.N,U=t.C},function(t){z=t.f,W=t.n,B=t.o,G=t.j,X=t.p,V=t.q,j=t.b,Y=t.I,J=t.l,q=t.c},function(t){Q=t.d,K=t.j,Z=t.b},function(t){$=t.aq,tt=t.b,et=t.a9,it=t.d,nt=t.f,st=t.v},function(){},function(t){ot=t.a,rt=t.b,at=t.c,t.T,ht=t.n,lt=t.o,ut=t.p,ct=t.d,pt=t.j,dt=t.i,_t=t.f,ft=t.H,mt=t.F,gt=t.V,yt=t.C,Ct=t.S},function(){}],execute:function(){var vt,bt,Tt;t("e",vt),function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(vt||t("e",vt={})),e(vt),t("d",bt),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(bt||t("d",bt={})),e(bt),t("f",Tt),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(Tt||t("f",Tt={})),e(Tt);var Et=Math.PI,St=Math.min,Rt=Math.max,Lt=Math.cos,xt=Math.sin,Dt=Math.abs,It=Math.sign,At=.5522847493;function Pt(t,e,i,n,s){t.moveTo(e-n,i),t.bezierCurveTo(e-n,i+s*At,e-n*At,i+s,e,i+s),t.bezierCurveTo(e+n*At,i+s,e+n,i+s*At,e+n,i),t.bezierCurveTo(e+n,i-s*At,e+n*At,i-s,e,i-s),t.bezierCurveTo(e-n*At,i-s,e-n,i-s*At,e-n,i),t.close()}function Ot(t,e,i,n,s,o,r,a,h,l,u){var c,p,d,_,f,m,g,y,C,v,b,T,E,S,R,L;l>10||(f=.5*(o+a),m=.5*(r+h),g=.5*((c=.5*(e+n))+(d=.5*(n+o))),y=.5*((p=.5*(i+s))+(_=.5*(s+r))),((R=Dt((n-a)*(S=h-i)-(s-h)*(E=a-e)))+(L=Dt((o-a)*S-(r-h)*E)))*(R+L)<t.tessTol*(E*E+S*S)?t.addPoint(a,h,0===u?u|Tt.PT_BEVEL:u):(Ot(t,e,i,c,p,g,y,b=.5*(g+(C=.5*(d+f))),T=.5*(y+(v=.5*(_+m))),l+1,0),Ot(t,b,T,C,v,f,m,a,h,l+1,u)))}var Mt,kt,Nt,wt,Ht,Ft,Ut,zt,Wt,Bt,Gt,Xt,Vt,jt,Yt,Jt,qt,Qt,Kt,Zt,$t,te,ee,ie=t("P",function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).dx=0,e.dy=0,e.dmx=0,e.dmy=0,e.flags=0,e.len=0,e}return i(e,t),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(n)),ne=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[]}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points.length=0},t}(),se=function(){function t(t){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=s.WHITE.clone(),this.lineCap=vt.BUTT,this.strokeColor=s.BLACK.clone(),this.lineJoin=bt.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null,this._comp=void 0,this._comp=t}var e=t.prototype;return e.moveTo=function(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,Tt.PT_CORNER),this._commandX=t,this._commandY=e},e.lineTo=function(t,e){this.addPoint(t,e,Tt.PT_CORNER),this._commandX=t,this._commandY=e},e.bezierCurveTo=function(t,e,i,n,s,o){var r=this._curPath,a=r.points[r.points.length-1];a&&(a.x!==t||a.y!==e||i!==s||n!==o?(Ot(this,a.x,a.y,t,e,i,n,s,o,0,Tt.PT_CORNER),this._commandX=s,this._commandY=o):this.lineTo(s,o))},e.quadraticCurveTo=function(t,e,i,n){var s=this._commandX,o=this._commandY;this.bezierCurveTo(s+2/3*(t-s),o+2/3*(e-o),i+2/3*(t-i),n+2/3*(e-n),i,n)},e.arc=function(t,e,i,n,s,o){!function(t,e,i,n,s,o,r){var a,h,l=0,u=0,c=0,p=0,d=0,_=0,f=0,m=0,g=0,y=0,C=0,v=0,b=0,T=0;if(u=o-s,r=r||!1)if(Dt(u)>=2*Et)u=2*Et;else for(;u<0;)u+=2*Et;else if(Dt(u)>=2*Et)u=2*-Et;else for(;u>0;)u-=2*Et;for(h=0|Rt(1,St(Dt(u)/(.5*Et)+.5,5)),c=Dt(4/3*(1-Lt(a=u/h/2))/xt(a)),r||(c=-c),T=0;T<=h;T++)_=e+(p=Lt(l=s+u*(T/h)))*n,f=i+(d=xt(l))*n,m=-d*n*c,g=p*n*c,0===T?t.moveTo(_,f):t.bezierCurveTo(y+v,C+b,_-m,f-g,_,f),y=_,C=f,v=m,b=g}(this,t,e,i,n,s,o)},e.ellipse=function(t,e,i,n){Pt(this,t,e,i,n),this._curPath.complex=!1},e.circle=function(t,e,i){Pt(this,t,e,i,i),this._curPath.complex=!1},e.rect=function(t,e,i,n){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.close(),this._curPath.complex=!1},e.roundRect=function(t,e,i,n,s){!function(t,e,i,n,s,o){if(o<.1)t.rect(e,i,n,s);else{var r=St(o,.5*Dt(n))*It(n),a=St(o,.5*Dt(s))*It(s);t.moveTo(e,i+a),t.lineTo(e,i+s-a),t.bezierCurveTo(e,i+s-a*(1-At),e+r*(1-At),i+s,e+r,i+s),t.lineTo(e+n-r,i+s),t.bezierCurveTo(e+n-r*(1-At),i+s,e+n,i+s-a*(1-At),e+n,i+s-a),t.lineTo(e+n,i+a),t.bezierCurveTo(e+n,i+a*(1-At),e+n-r*(1-At),i,e+n-r,i),t.lineTo(e+r,i),t.bezierCurveTo(e+r*(1-At),i,e,i+a*(1-At),e,i+a),t.close()}}(this,t,e,i,n,s),this._curPath.complex=!1},e.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,e=0,i=t.length;e<i;e++){var n=t[e];n&&(z.remove(n),n.removeRenderDrawInfo(this._comp))}this._renderDataList.length=0},e.close=function(){this._curPath.closed=!0},e.requestRenderData=function(){var t=z.add();return this._renderDataList.push(t),t},e.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},e.addPoint=function(t,e,i){var n=this._curPath;if(n){var s=this._points,o=n.points,r=s[this.pointsOffset++];r?(r.x=t,r.y=e):(r=new ie(t,e),s.push(r)),r.flags=i,o.push(r)}},e._addPath=function(){var t=this.pathLength,e=this.paths[t];return e?e.reset():(e=new ne,this.paths.push(e)),this.pathLength++,this._curPath=e,e},t}(),oe=W.concat([new $("a_dist",tt.R32F)]),re=B(oe),ae=G(oe),he=t("G",(Mt=o("cc.Graphics"),kt=d(110),Nt=r(bt),wt=r(vt),Mt(Ht=kt(((Vt=function(t){function e(){var e;return(e=t.call(this)||this).impl=null,e.model=null,e._lineWidth=Ut&&Ut(),e._strokeColor=zt&&zt(),e._lineJoin=Wt&&Wt(),e._lineCap=Bt&&Bt(),e._fillColor=Gt&&Gt(),e._miterLimit=Xt&&Xt(),e._isDrawing=!1,e._isNeedUploadData=!0,e._graphicsUseSubMeshes=[],e._instanceMaterialType=Y.ADD_COLOR,e.impl=new se(_(e)),e}i(e,t);var n=e.prototype;return n.onRestore=function(){this.impl||this._flushAssembler()},n.onLoad=function(){t.prototype.onLoad.call(this),this.model=A.root.createModel(P),this.model.node=this.model.transform=this.node,this._flushAssembler()},n.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},n.onDestroy=function(){this._sceneGetter=null,this.model&&(A.root.destroyModel(this.model),this.model=null);var e=this._graphicsUseSubMeshes.length;if(e>0){for(var i=0;i<e;++i)this._graphicsUseSubMeshes[i].destroy();this._graphicsUseSubMeshes.length=0}this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null),t.prototype.onDestroy.call(this)},n.moveTo=function(t,e){this.impl&&this.impl.moveTo(t,e)},n.lineTo=function(t,e){this.impl&&this.impl.lineTo(t,e)},n.bezierCurveTo=function(t,e,i,n,s,o){this.impl&&this.impl.bezierCurveTo(t,e,i,n,s,o)},n.quadraticCurveTo=function(t,e,i,n){this.impl&&this.impl.quadraticCurveTo(t,e,i,n)},n.arc=function(t,e,i,n,s,o){this.impl&&this.impl.arc(t,e,i,n,s,o)},n.ellipse=function(t,e,i,n){this.impl&&this.impl.ellipse(t,e,i,n)},n.circle=function(t,e,i){this.impl&&this.impl.circle(t,e,i)},n.rect=function(t,e,i,n){this.impl&&this.impl.rect(t,e,i,n)},n.roundRect=function(t,e,i,n,s){this.impl&&this.impl.roundRect(t,e,i,n,s)},n.fillRect=function(t,e,i,n){this.rect(t,e,i,n),this.fill()},n.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},n.close=function(){this.impl&&this.impl.close()},n.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},n.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},n._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=O.get("ui-graphics-material"),this.setSharedMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},n.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var e=Q.gfxDevice,i=e.createBuffer(new et(it.VERTEX|it.TRANSFER_DST,nt.DEVICE,65535*ae,ae)),n=e.createBuffer(new et(it.INDEX|it.TRANSFER_DST,nt.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),s=new M([i],oe,st.TRIANGLE_LIST,n);s.subMeshIdx=0,this.model.initSubModel(t,s,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(s)}}else a(4500,this.node.name)},n._uploadData=function(){var t=this.impl;if(t){var e=t&&t.getRenderDataList();if(!(e.length<=0)&&this.model){for(var i=this.model.subModels,n=0;n<e.length;n++){var s=e[n],o=i[n].inputAssembler;if(s.lastFilledVertex!==s.vertexStart){var r=new Float32Array(s.vData.buffer,0,s.vertexStart*re);o.vertexBuffers[0].update(r),o.vertexCount=s.vertexStart;var a=new Uint16Array(s.iData.buffer,0,s.indexStart);o.indexBuffer.update(a),o.indexCount=s.indexStart,s.lastFilledVertex=s.vertexStart,s.lastFilledIndex=s.indexStart}}this._isNeedUploadData=!1}}},n._render=function(t){if(this._isNeedUploadData){if(this.impl){var e=this.impl.getRenderDataList(),i=this.model.subModels.length;if(e.length>i)for(var n=i;n<e.length;n++)this.activeSubModel(n)}this._uploadData()}t.commitModel(this,this.model,this.getMaterialInstance(0))},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},n._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},n.updateRenderer=function(){t.prototype.updateRenderer.call(this)},n.createRenderEntity=function(){return new X(V.DYNAMIC)},h(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"graphicsNativeProxy",get:function(){return this._graphicsNativeProxy}}]),e}(j)).LineJoin=bt,Vt.LineCap=vt,l((Ft=Vt).prototype,"lineJoin",[Nt],Object.getOwnPropertyDescriptor(Ft.prototype,"lineJoin"),Ft.prototype),l(Ft.prototype,"lineCap",[wt],Object.getOwnPropertyDescriptor(Ft.prototype,"lineCap"),Ft.prototype),l(Ft.prototype,"color",[u],Object.getOwnPropertyDescriptor(Ft.prototype,"color"),Ft.prototype),Ut=c(Ft.prototype,"_lineWidth",[f],(function(){return 1})),zt=c(Ft.prototype,"_strokeColor",[f],(function(){return s.BLACK.clone()})),Wt=c(Ft.prototype,"_lineJoin",[f],(function(){return bt.MITER})),Bt=c(Ft.prototype,"_lineCap",[f],(function(){return vt.BUTT})),Gt=c(Ft.prototype,"_fillColor",[f],(function(){return s.WHITE.clone()})),Xt=c(Ft.prototype,"_miterLimit",[f],(function(){return 10})),Ht=Ft))||Ht)||Ht));p.Graphics=he;var le,ue=new m,ce=new n,pe=new m,de=[];!function(t){t[t.GRAPHICS_RECT=0]="GRAPHICS_RECT",t[t.GRAPHICS_ELLIPSE=1]="GRAPHICS_ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.SPRITE_STENCIL=3]="SPRITE_STENCIL"}(le||(le={})),e(le);var _e,fe=t("M",(jt=o("cc.Mask"),Yt=d(110),Jt=r(le),jt(qt=Yt(((ee=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._type=Kt&&Kt(),e._inverted=Zt&&Zt(),e._segments=$t&&$t(),e._alphaThreshold=te&&te(),e._sprite=null,e._graphics=null,e._stencilStage=J.DISABLED,e}i(e,t);var o=e.prototype;return o.onLoad=function(){this._changeRenderType()},o.onEnable=function(){this._changeRenderType(),this._updateGraphics(),this._enableRender(),this.node.on(F.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(F.SIZE_CHANGED,this._nodeStateChange,this)},o.onRestore=function(){this._changeRenderType(),this._updateGraphics()},o.onDisable=function(){this._disableRender(),this.node.off(F.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(F.SIZE_CHANGED,this._nodeStateChange,this)},o.onDestroy=function(){this._removeMaskNode()},o.isHit=function(t){var e=this.node._uiProps.uiTransformComp,i=e.contentSize,s=i.width,o=i.height,r=ce;this.node.getWorldMatrix(ue),m.invert(pe,ue),n.transformMat4(r,t,pe);var a=e.anchorPoint;r.x+=a.x*s,r.y+=a.y*o;var h=!1;if(this.type===le.GRAPHICS_RECT||this.type===le.GRAPHICS_STENCIL||this.type===le.SPRITE_STENCIL)h=r.x>=0&&r.y>=0&&r.x<=s&&r.y<=o;else if(this.type===le.GRAPHICS_ELLIPSE){var l=s/2,u=o/2,c=r.x-.5*s,p=r.y-.5*o;h=c*c/(l*l)+p*p/(u*u)<1}return this._inverted&&(h=!h),h},o._nodeStateChange=function(){this._updateGraphics()},o._changeRenderType=function(){this._type!==le.SPRITE_STENCIL?this._createGraphics():this._createSprite()},o._createSprite=function(){if(!this._sprite){var t=this._sprite=this.node.getComponent(ot);if(!t){var e=this.node;t=this._sprite=e.addComponent(ot)}}this._sprite.stencilStage=this.inverted?J.ENTER_LEVEL_INVERTED:J.ENTER_LEVEL,this._sprite.updateMaterial()},o._createGraphics=function(){if(!this._graphics){var t=this._graphics=this.node.getComponent(he);if(!t){var e=this.node;t=this._graphics=e.addComponent(he)}t.lineWidth=1;var i=s.WHITE.clone();i.a=0,t.fillColor=i}this._graphics.stencilStage=this.inverted?J.ENTER_LEVEL_INVERTED:J.ENTER_LEVEL},o._updateGraphics=function(){if(this._graphics&&(this._type===le.GRAPHICS_RECT||this._type===le.GRAPHICS_ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var i=t.contentSize,n=i.width,s=i.height,o=t.anchorPoint,r=-n*o.x,a=-s*o.y;if(this._type===le.GRAPHICS_RECT)e.rect(r,a,n,s);else if(this._type===le.GRAPHICS_ELLIPSE){for(var h=function(t,e,i){de.length=0;for(var n=2*Math.PI/i,s=0;s<i;++s)de.push(new g(e.x*Math.cos(n*s)+t.x,e.y*Math.sin(n*s)+t.y,0));return de}(new g(r+n/2,a+s/2,0),new g(n/2,s/2,0),this._segments),l=0;l<h.length;++l){var u=h[l];0===l?e.moveTo(u.x,u.y):e.lineTo(u.x,u.y)}e.close()}e.fill()}},o._enableRender=function(){this.subComp&&(this.subComp.enabled=!0)},o._disableRender=function(){this.subComp&&(this.subComp.stencilStage=J.DISABLED,this.subComp.updateMaterial(),this.node.activeInHierarchy&&(this.subComp.enabled=!1))},o._removeMaskNode=function(){this._sprite&&(this._sprite=null),this._graphics&&(this._graphics=null)},o.markForUpdateRenderData=function(t){void 0===t&&(t=!0),a(9007),this.subComp&&this.subComp.markForUpdateRenderData(t)},o.requestRenderData=function(){a(9007)},o.destroyRenderData=function(){a(9007)},o.updateRenderer=function(){a(9007),this.subComp&&this.subComp.updateRenderer()},o.fillBuffers=function(){a(9007)},o.postUpdateAssembler=function(){a(9007)},o.setNodeDirty=function(){a(9007),this.subComp&&this.subComp.setNodeDirty()},o.setTextureDirty=function(){a(9007),this.subComp&&this.subComp.setTextureDirty()},o.getMaterial=function(t){return a(9007),this.subComp?this.subComp.getSharedMaterial(t):null},o.setMaterial=function(t,e){a(9007),this.subComp&&this.subComp.setMaterial(t,e)},o.getMaterialInstance=function(t){return a(9007),this.subComp?this.subComp.getMaterialInstance(t):null},o.setMaterialInstance=function(t,e){a(9007),this.subComp&&this.subComp.setMaterialInstance(t,e)},o.getRenderMaterial=function(t){return a(9007),this.subComp?this.subComp.getRenderMaterial(t):null},h(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._type!==le.SPRITE_STENCIL?(this._sprite&&(this.node.removeComponent(ot),this._sprite._destroyImmediate(),this._sprite=null),this._changeRenderType(),this._updateGraphics()):(this._graphics&&(this._graphics.clear(),this.node.removeComponent(he),this._graphics._destroyImmediate(),this._graphics=null),this._changeRenderType()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.subComp.stencilStage=this.inverted?J.ENTER_LEVEL_INVERTED:J.ENTER_LEVEL}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=y(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._sprite?this._sprite.spriteFrame:null},set:function(t){this._sprite?this._sprite.spriteFrame=t:C("please change type to sprite_stencil first")}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===le.SPRITE_STENCIL&&this._sprite&&this._sprite.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"subComp",get:function(){return this._graphics||this._sprite}},{key:"customMaterial",get:function(){return a(9007),this.subComp?this.subComp.customMaterial:null},set:function(t){a(9007),this.subComp&&(this.subComp.customMaterial=t)}},{key:"color",get:function(){return a(9007),this.subComp?this.subComp.color:null},set:function(t){a(9007),this.subComp&&t&&(this.subComp.color=t)}},{key:"sharedMaterial",get:function(){return a(9007),this.subComp?this.subComp.sharedMaterial:null}},{key:"sharedMaterials",get:function(){return a(9007),this.subComp?this.subComp.sharedMaterials:null},set:function(t){a(9007),this.subComp&&t&&(this.subComp.sharedMaterials=t)}},{key:"material",get:function(){return a(9007),this.subComp?this.subComp.material:null},set:function(t){a(9007),this.subComp&&(this.subComp.material=t)}},{key:"materials",get:function(){return a(9007),this.subComp?this.subComp.materials:[null]},set:function(t){a(9007),this.subComp&&(this.subComp.materials=t)}}]),e}(U)).Type=le,l((Qt=ee).prototype,"type",[Jt],Object.getOwnPropertyDescriptor(Qt.prototype,"type"),Qt.prototype),Kt=c(Qt.prototype,"_type",[f],(function(){return le.GRAPHICS_RECT})),Zt=c(Qt.prototype,"_inverted",[f],(function(){return!1})),$t=c(Qt.prototype,"_segments",[f],(function(){return 64})),te=c(Qt.prototype,"_alphaThreshold",[f],(function(){return.1})),qt=Qt))||qt)||qt));k._maskComp=fe,p.Mask=fe;var me,ge,ye,Ce,ve,be,Te,Ee,Se,Re,Le,xe,De,Ie,Ae,Pe,Oe,Me,ke,Ne,we,He,Fe,Ue,ze,We=t("L",o("cc.LabelOutline")(_e=d(110)(_e=v(rt)(_e=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var n=e.prototype;return n.onEnable=function(){this.node.getComponent(rt).enableOutline=!0},n.onDisable=function(){this.node.getComponent(rt).enableOutline=!1},h(e,[{key:"color",get:function(){return this.node.getComponent(rt).outlineColor},set:function(t){this.node.getComponent(rt).outlineColor=t}},{key:"width",get:function(){return this.node.getComponent(rt).outlineWidth},set:function(t){this.node.getComponent(rt).outlineWidth=t}}]),e}(U))||_e)||_e)||_e);p.LabelOutline=We;var Be=new at,Ge="RICHTEXT_CHILD",Xe="RICHTEXT_Image_CHILD",Ve=new n,je=new n,Ye=new b((function(t){if(!p.isValid(t.node))return!1;var e=t.node.getComponent(We);return e&&(e.width=0),!0}),20),Je=new b((function(t){return p.isValid(t.node)}),10);function qe(t){return{node:new N(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function Qe(t,e){var i;t===Ge?i=Ye._get():t===Xe&&(i=Je._get());var n=(i=i||qe(t)).node;return n||(n=new N(t)),n.hideFlags|=E.Flags.DontSave|E.Flags.HideInHierarchy,n.active=!0,t===Xe?(i.comp=n.getComponent(ot)||n.addComponent(ot),i.comp.spriteFrame=e,i.comp.type=ot.Type.SLICED,i.comp.sizeMode=ot.SizeMode.CUSTOM):(i.comp=n.getComponent(rt)||n.addComponent(rt),i.comp.string=e,i.comp.horizontalAlign=ft.LEFT,i.comp.verticalAlign=gt.TOP,i.comp.underlineHeight=2),n.setPosition(0,0,0),n._uiProps.uiTransformComp.setAnchorPoint(.5,.5),i.node=n,i.lineCount=0,i.styleIndex=0,i.imageOffset="",i.clickParam="",i.clickHandler="",i}var Ke,Ze=t("R",(me=o("cc.RichText"),ge=d(110),ye=r(ft),Ce=r(gt),ve=r(s),be=r(mt),Te=r(yt),Ee=r(Ct),me(Se=ge(((ze=function(t){function e(){var e;return(e=t.call(this)||this)._lineHeight=Le&&Le(),e._string=xe&&xe(),e._horizontalAlign=De&&De(),e._verticalAlign=Ie&&Ie(),e._fontSize=Ae&&Ae(),e._fontColor=Pe&&Pe(),e._maxWidth=Oe&&Oe(),e._fontFamily=Me&&Me(),e._font=ke&&ke(),e._isSystemFontUsed=Ne&&Ne(),e._userDefinedFont=we&&we(),e._cacheMode=He&&He(),e._imageAtlas=Fe&&Fe(),e._handleTouchEvent=Ue&&Ue(),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._labelChildrenNum=0,e._updateRichTextStatus=e._updateRichText,e}i(e,t);var o=e.prototype;return o.onLoad=function(){this.node.on(F.LAYER_CHANGED,this._applyLayer,this),this.node.on(F.ANCHOR_CHANGED,this._updateRichTextPosition,this)},o.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},o.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},o.onRestore=function(){},o.onDestroy=function(){for(var t,e=T(this._segments);!(t=e()).done;){var i=t.value;i.node.removeFromParent(),i.type===Ge?Ye.put(i):i.type===Xe&&Je.put(i)}this.node.off(F.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(F.LAYER_CHANGED,this._applyLayer,this)},o._addEventListeners=function(){this.node.on(F.TOUCH_END,this._onTouchEnded,this)},o._removeEventListeners=function(){this.node.off(F.TOUCH_END,this._onTouchEnded,this)},o._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},o._createFontLabel=function(t){return Qe(Ge,t)},o._createImage=function(t){return Qe(Xe,t)},o._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},o.splitLongStringApproximatelyIn2048=function(t,e){var i=[];if(t.length*this.fontSize<=1638.4)return i.push(t),i;if(this._calculateSize(Ve,e,t),Ve.x<2048)i.push(t);else for(var n=t.split("\n"),s=0;s<n.length;s++)if(this._calculateSize(Ve,e,n[s]),Ve.x<2048)i.push(n[s]);else{var o=this.splitLongStringOver2048(n[s],e);i.push.apply(i,o)}return i},o.splitLongStringOver2048=function(t,e){var i=[],n=t,s=0,o=n.length/2,r=n.substring(s,o),a=n.substring(o),h=this._calculateSize(Ve,e,r),l=this._calculateSize(je,e,a),u=this._maxWidth;0===this._maxWidth&&(u=2047.9);for(var c=1*u;h.x>c;){if((o/=2)<1){o*=2;break}r=r.substring(s,o),a=n.substring(o),this._calculateSize(h,e,r)}for(var p=1e3,d=1;p&&s<t.length;){for(;p&&h.x<c;){var _=ht(a);_&&_.length>0&&(d=_[0].length),o+=d,r=n.substring(s,o),a=n.substring(o),this._calculateSize(h,e,r),p--}for(;p&&r.length>=2&&h.x>c;)o-=d,r=n.substring(s,o),this._calculateSize(h,e,r),d=1,p--;if(r.length>=2){var f=lt(r);f&&f.length>0&&r!==f[0]&&(o-=f[0].length,r=n.substring(s,o))}if(i.push(r),s=o,o+=r.length,r=n.substring(s,o),a=n.substring(o),this._calculateSize(l,e,a),this._calculateSize(h,e,r),p--,l.x<2048&&h.x<c){i.push(r),s=t.length,o=t.length,r=a,""!==a&&i.push(r);break}}return i},o._measureText=function(t,e){var i=this,n=function(e){return i._calculateSize(Ve,t,e).x};return e?n(e):n},o._calculateSize=function(t,e,i){var s;0===this._labelSegmentsCache.length?(s=this._createFontLabel(i),this._labelSegmentsCache.push(s)):(s=this._labelSegmentsCache[0]).node.getComponent(rt).string=i,s.styleIndex=e,this._applyTextAttribute(s);var o=s.node._uiProps.uiTransformComp.contentSize;return n.set(t,o.x,o.y),t},o._onTouchEnded=function(t){for(var e,i=this,n=this.node.getComponents(U),s=function(){var s=e.value,o=s.clickHandler,r=s.clickParam;o&&i._containsTouchLocation(s,t.touch.getUILocation())&&(n.forEach((function(e){var i=e[o];e.enabledInHierarchy&&i&&i.call(e,t,r)})),t.propagationStopped=!0)},o=T(this._segments);!(e=o()).done;)s()},o._containsTouchLocation=function(t,e){var i=t.node.getComponent(q);return!!i&&i.getBoundingBoxToWorld().contains(e)},o._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var i=t[e];if(i.name===Ge||i.name===Xe){i.parent=null;var n=qe(i.name);n.node=i,i.name===Ge?(n.comp=i.getComponent(rt),Ye.put(n)):(n.comp=i.getComponent(ot),Je.put(n)),this._labelChildrenNum--}}this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},o._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];i.name!==Ge&&i.name!==Xe||(i.active=t)}},o._addLabelSegment=function(t,e){var i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{var n=(i=this._labelSegmentsCache.pop()).node.getComponent(rt);n&&(n.string=t)}var s=i.comp;return s.verticalAlign!==this._verticalAlign&&(s.verticalAlign=this._verticalAlign),i.styleIndex=e,i.lineCount=this._lineCount,i.node._uiProps.uiTransformComp.setAnchorPoint(0,0),i.node.layer=this.node.layer,this.node.insertChild(i.node,this._labelChildrenNum++),this._applyTextAttribute(i),this._segments.push(i),i},o._updateRichTextWithMaxWidth=function(t,e,i){var n=e;if(this._lineOffsetX>0&&n+this._lineOffsetX>this._maxWidth)for(var s=0;this._lineOffsetX<=this._maxWidth;){var o=this._getFirstWordLen(t,s,t.length),r=t.substr(s,o),a=this._measureText(i,r);if(!(this._lineOffsetX+a<=this._maxWidth)){if(s>0){var h=t.substr(0,s);this._addLabelSegment(h,i),t=t.substr(s,t.length),n=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=a,s+=o}if(n>this._maxWidth)for(var l=ut(t,n,this._maxWidth,this._measureText(i)),u=0;u<l.length;++u){var c=l[u],p=this._addLabelSegment(c,i).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=p.width,l.length>1&&u<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,i)},o._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},o._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},o._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var i=this._textArray[e],n=t[e];if(i.text!==n.text)return!0;var s=i.style,o=n.style;if(s){if(o){if(!!o.outline!=!!s.outline)return!0;if(s.size!==o.size||s.italic!==o.italic||s.isImage!==o.isImage)return!0;if(s.src!==o.src||s.imageAlign!==o.imageAlign||s.imageHeight!==o.imageHeight||s.imageWidth!==o.imageWidth||s.imageOffset!==o.imageOffset)return!0}else if(s.size||s.italic||s.isImage||s.outline)return!0}else if(o&&(o.size||o.italic||o.isImage||o.outline))return!0}return!1},o._addRichTextImageElement=function(t){if(t.style){var e=t.style,i=e.src,n=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(n){var s=this._createImage(n);switch(s.comp,e.imageAlign){case"top":s.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":s.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:s.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}e.imageOffset&&(s.imageOffset=e.imageOffset),s.node.layer=this.node.layer,this.node.insertChild(s.node,this._labelChildrenNum++),this._segments.push(s);var o=n.rect.clone(),r=1,h=o.width,l=o.height,u=e.imageWidth||0,c=e.imageHeight||0;c>0?(h*=r=c/l,l*=r):(h*=r=this._lineHeight/l,l*=r),u>0&&(h=u),this._maxWidth>0?(this._lineOffsetX+h>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=h):(this._lineOffsetX+=h,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),s.node._uiProps.uiTransformComp.setContentSize(h,l),s.lineCount=this._lineCount,s.clickHandler="",s.clickParam="";var p=e.event;p&&(s.clickHandler=p.click,s.clickParam=p.param)}else a(4400)}},o._updateTextDefaultColor=function(){for(var t=0;t<this._segments.length;++t){var e,i,n=this._segments[t],s=n.node.getComponent(rt);s&&(null!==(e=this._textArray[n.styleIndex])&&void 0!==e&&null!==(i=e.style)&&void 0!==i&&i.color||(s.color=this._fontColor))}},o._updateRichText=function(){if(this.enabledInHierarchy){var t=Be.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,i=!1,n=0;n<this._textArray.length;++n){var s=this._textArray[n],o=s.text;if(void 0!==o){if(""===o){if(s.style&&s.style.isNewLine){this._updateLineInfo();continue}if(s.style&&s.style.isImage&&this._imageAtlas){this._addRichTextImageElement(s);continue}}for(var r=(o=this.splitLongStringApproximatelyIn2048(o,n).join("\n")).split("\n"),a=0;a<r.length;++a){var h=r[a];if(""!==h)if(i=!1,this._maxWidth>0){var l=this._measureText(n,h);this._updateRichTextWithMaxWidth(h,l,n),r.length>1&&a<r.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(h,n),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),r.length>1&&a<r.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(o)&&a===r.length-1)continue;this._updateLineInfo(),i=!0}}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+ct)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},o._getFirstWordLen=function(t,e,i){var n=pt(t,e);if(dt(n)||_t(n))return 1;for(var s=1,o=e+1;o<i&&(n=pt(t,o),!_t(n)&&!dt(n));++o)s++;return s},o._updateRichTextPosition=function(){for(var t=0,e=1,i=this._lineCount,n=this.node._uiProps.uiTransformComp,s=n.anchorX,o=n.anchorY,r=0;r<this._segments.length;++r){var a=this._segments[r],h=a.lineCount;h>e&&(t=0,e=h);var l=this._labelWidth*(.5*this._horizontalAlign-s);switch(this._horizontalAlign){case ft.LEFT:break;case ft.CENTER:l-=this._linesWidth[h-1]/2;break;case ft.RIGHT:l-=this._linesWidth[h-1]}var u=a.node.position;if(a.node.setPosition(t+l,this._lineHeight*(i-h)-this._labelHeight*o,u.z),h===e&&(t+=a.node._uiProps.uiTransformComp.width),a.node.getComponent(ot)){var c=a.node.position.clone(),p=this._lineHeight,d=this._lineHeight*(1+ct);switch(a.node._uiProps.uiTransformComp.anchorY){case 1:c.y+=p+(d-p)/2;break;case.5:c.y+=d/2;break;default:c.y+=(d-p)/2}if(a.imageOffset){var _=a.imageOffset.split(",");if(1===_.length&&_[0]){var f=parseFloat(_[0]);Number.isInteger(f)&&(c.y+=f)}else if(2===_.length){var m=parseFloat(_[0]),g=parseFloat(_[1]);Number.isInteger(m)&&(c.x+=m),Number.isInteger(g)&&(c.y+=g)}}a.node.position=c}var y=a.node.getComponent(We);if(y){var C=a.node.position.clone();C.y-=y.width,a.node.position=C}}},o._convertLiteralColorValue=function(t){var e=t.toUpperCase();return s[e]?s[e]:(new s).fromHEX(t)},o._applyTextAttribute=function(t){var e=t.node.getComponent(rt);if(e){this._resetLabelState(e);var i,n=t.styleIndex;if(this._textArray[n]&&(i=this._textArray[n].style),i){if(i.color?e.color=this._convertLiteralColorValue(i.color):e.color=this._fontColor,e.isBold=!!i.bold,e.isItalic=!!i.italic,e.isUnderline=!!i.underline,i.outline){var s=t.node.getComponent(We);s||(s=t.node.addComponent(We)),s.color=this._convertLiteralColorValue(i.outline.color),s.width=i.outline.width}e.fontSize=i.size||this._fontSize,t.clickHandler="",t.clickParam="";var o=i.event;o&&(t.clickHandler=o.click||"",t.clickParam=o.param||"")}e.cacheMode=this._cacheMode,this._font instanceof mt&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0)}},o._applyLayer=function(){for(var t,e=T(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},o._resetLabelState=function(t){t.fontSize=this._fontSize,t.color=this._fontColor,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1},h(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontColor",get:function(){return this._fontColor},set:function(t){this._fontColor!==t&&(this._fontColor=t,this._updateTextDefaultColor())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}(U)).HorizontalAlign=ft,ze.VerticalAlign=gt,l((Re=ze).prototype,"horizontalAlign",[ye],Object.getOwnPropertyDescriptor(Re.prototype,"horizontalAlign"),Re.prototype),l(Re.prototype,"verticalAlign",[Ce],Object.getOwnPropertyDescriptor(Re.prototype,"verticalAlign"),Re.prototype),l(Re.prototype,"fontColor",[ve],Object.getOwnPropertyDescriptor(Re.prototype,"fontColor"),Re.prototype),l(Re.prototype,"font",[be],Object.getOwnPropertyDescriptor(Re.prototype,"font"),Re.prototype),l(Re.prototype,"cacheMode",[Te],Object.getOwnPropertyDescriptor(Re.prototype,"cacheMode"),Re.prototype),l(Re.prototype,"imageAtlas",[Ee],Object.getOwnPropertyDescriptor(Re.prototype,"imageAtlas"),Re.prototype),Le=c(Re.prototype,"_lineHeight",[f],(function(){return 40})),xe=c(Re.prototype,"_string",[f],(function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"})),De=c(Re.prototype,"_horizontalAlign",[f],(function(){return ft.LEFT})),Ie=c(Re.prototype,"_verticalAlign",[f],(function(){return gt.TOP})),Ae=c(Re.prototype,"_fontSize",[f],(function(){return 40})),Pe=c(Re.prototype,"_fontColor",[f],(function(){return s.WHITE.clone()})),Oe=c(Re.prototype,"_maxWidth",[f],(function(){return 0})),Me=c(Re.prototype,"_fontFamily",[f],(function(){return"Arial"})),ke=c(Re.prototype,"_font",[f],(function(){return null})),Ne=c(Re.prototype,"_isSystemFontUsed",[f],(function(){return!0})),we=c(Re.prototype,"_userDefinedFont",[f],(function(){return null})),He=c(Re.prototype,"_cacheMode",[f],(function(){return yt.NONE})),Fe=c(Re.prototype,"_imageAtlas",[f],(function(){return null})),Ue=c(Re.prototype,"_handleTouchEvent",[f],(function(){return!0})),Se=Re))||Se)||Se));p.RichText=Ze;var $e=t("U",o("cc.UIMeshRenderer")(Ke=d(110)(Ke=function(t){function e(){var e;return(e=t.call(this)||this)._modelComponent=null,e._dirtyVersion=-1,e._internalId=-1,e.stencilStage=J.DISABLED,e._renderData=null,e._renderEntity=new X(V.DYNAMIC),e}i(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){w.addRenderer(this),this.markForUpdateRenderData()},n.onDisable=function(){w.removeRenderer(this),this.renderEntity.enabled=this._canRender()},n.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.ModelRenderer"),this._modelComponent?this.renderEntity.setNode(this.node):S("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},n.onDestroy=function(){this.renderEntity.setNode(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this._modelComponent=this.getComponent("cc.ModelRenderer"),this._modelComponent&&(this._modelComponent._sceneGetter=null)},n._render=function(t){if(this._modelComponent){var e=this._modelComponent._collectModels();this._modelComponent._detachFromScene();for(var i=0;i<e.length;i++)e[i].enabled&&t.commitModel(this,e[i],this._modelComponent.material);return!0}return!1},n.fillBuffers=function(t){this.enabled&&this._render(t)},n.updateRenderer=function(){},n._uploadRenderData=function(){},n.postUpdateAssembler=function(){},n.update=function(){this._fitUIRenderQueue()},n._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var i=this._modelComponent.getMaterialInstance(e);if(null!=i)for(var n=i.passes,s=n.length,o=0;o<s;o++)n[o].setPriority(K.MAX-11),i.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},o)}},n.markForUpdateRenderData=function(){w.markDirtyRenderer(this)},n.setNodeDirty=function(){},n.setTextureDirty=function(){},n._canRender=function(){return this.enabled&&null!==this._modelComponent},h(e,[{key:"modelComponent",get:function(){return this._modelComponent}},{key:"renderEntity",get:function(){return this._renderEntity}},{key:"renderData",get:function(){return this._renderData}}]),e}(U))||Ke)||Ke);p.UIMeshRenderer=$e;var ti,ei,ii,ni,si,oi,ri=Z.Enum.NONE|Z.Enum.UI_3D,ai=t("D",function(){function t(){this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._passes=[],this._shaders=[],this._visFlags=ri,this._inputAssembler=null,this._descriptorSet=null}var e=t.prototype;return e.destroy=function(){this._passes=[]},e.clear=function(){this._inputAssembler=null,this._descriptorSet=null,this.texture=null,this.sampler=null,this.textureHash=0,this.samplerHash=0,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=ri},e.fillPasses=function(t,e,i,n){if(t){var s=t.passes;if(!s)return;this._shaders.length=s.length;for(var o=0;o<s.length;o++){this._passes[o]||(this._passes[o]=new H(p.director.root));var r=s[o],a=this._passes[o];r.update(),e||(e=r.depthStencilState,i=0),a._initPassFromTarget(r,e,i),this._shaders[o]=a.getShaderVariant(n)}}},h(t,[{key:"inputAssembler",get:function(){return this._inputAssembler},set:function(t){this._inputAssembler=t}},{key:"descriptorSet",get:function(){return this._descriptorSet},set:function(t){this._descriptorSet=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"passes",get:function(){return this._passes}},{key:"shaders",get:function(){return this._shaders}}]),t}()),hi=t("a",o("cc.UIStaticBatch")(ti=d(110)((ei=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._init=!1,e._bufferAccessor=null,e._dirty=!0,e._uiDrawBatchList=[],e}i(e,t);var n=e.prototype;return n.postUpdateAssembler=function(){},n.markAsDirty=function(){},n._requireDrawBatch=function(){var t=new ai;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},n._clearData=function(){if(this._bufferAccessor){this._bufferAccessor.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},n._getBatcher=function(){return A.root&&A.root.batcher2D?A.root.batcher2D:(a(9301),null)},h(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(j),l(ei.prototype,"color",[u],Object.getOwnPropertyDescriptor(ei.prototype,"color"),ei.prototype),ti=ei))||ti)||ti),li=t("b",o("cc.LabelShadow")(ii=d(110)(ii=v(rt)(ii=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var n=e.prototype;return n.onEnable=function(){this.node.getComponent(rt).enableShadow=!0},n.onDisable=function(){this.node.getComponent(rt).enableShadow=!1},h(e,[{key:"color",get:function(){return this.node.getComponent(rt).shadowColor},set:function(t){this.node.getComponent(rt).shadowColor=t}},{key:"offset",get:function(){return this.node.getComponent(rt).shadowOffset},set:function(t){this.node.getComponent(rt).shadowOffset=t}},{key:"blur",get:function(){return this.node.getComponent(rt).shadowBlur},set:function(t){this.node.getComponent(rt).shadowBlur=t}}]),e}(U))||ii)||ii)||ii),ui=t("c",o("cc.UIOpacity")(ni=d(110)(ni=R((si=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._setByParent=!1,e._opacity=oi&&oi(),e}i(e,t);var n=e.prototype;return n.setEntityLocalOpacityDirtyRecursively=function(){},e.setEntityLocalOpacityDirtyRecursively=function(t,i,n,s){if(t.isValid){var o=t._uiProps.uiComp,r=t.getComponent(e),a=n;o&&o.color?(o.renderEntity.colorDirty=i,r?(o.renderEntity.localOpacity=a*r.opacity/255,r._setByParent=s):o.renderEntity.localOpacity=a,o.node._uiProps.localOpacity=o.renderEntity.localOpacity,a=1):r&&(a=a*r.opacity/255,r._setByParent=s);for(var h=0;h<t.children.length;h++)e.setEntityLocalOpacityDirtyRecursively(t.children[h],i||a<1,a,!0)}},n.onEnable=function(){this._setByParent||(this.node._uiProps.localOpacity=this._opacity/255,this.setEntityLocalOpacityDirtyRecursively(!0))},n.onDisable=function(){this._setByParent||(this.node._uiProps.localOpacity=1,this.setEntityLocalOpacityDirtyRecursively(!0))},h(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=L(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255,this.setEntityLocalOpacityDirtyRecursively(!0))}}]),e}(U),oi=c(si.prototype,"_opacity",[f],(function(){return 255})),ni=si))||ni)||ni)||ni);p.MaskComponent=fe,x(fe,"cc.MaskComponent"),p.LabelComponent=rt,x(rt,"cc.LabelComponent"),p.LabelOutlineComponent=We,x(We,"cc.LabelOutlineComponent"),p.RichTextComponent=Ze,x(Ze,"cc.RichTextComponent"),p.SpriteComponent=ot,x(ot,"cc.SpriteComponent"),p.UIModelComponent=$e,x($e,"cc.UIModelComponent"),p.GraphicsComponent=he,x(he,"cc.GraphicsComponent"),x(hi,"cc.UIStaticBatchComponent"),x(ui,"cc.UIOpacityComponent"),D(fe.prototype,"Mask",[{name:"graphics",newName:"subComp",target:fe.prototype,targetName:"Mask"}]),D(le,"MaskType",[{name:"RECT",newName:"GRAPHICS_RECT",target:le,targetName:"MaskType"},{name:"ELLIPSE",newName:"GRAPHICS_ELLIPSE",target:le,targetName:"MaskType"},{name:"IMAGE_STENCIL",newName:"SPRITE_STENCIL",target:le,targetName:"MaskType"}]),I(We.prototype,"LabelOutline",[{name:"width",suggest:"Please use Label.outlineWidth instead."},{name:"color",suggest:"Please use Label.outlineColor instead."}]),I(li.prototype,"LabelShadow",[{name:"color",suggest:"Please use Label.shadowColor instead."},{name:"offset",suggest:"Please use Label.shadowOffset instead."},{name:"blur",suggest:"Please use Label.shadowBlur instead."}])}}}));
